<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >

<sqlMap namespace="oa.dao">
    <typeAlias alias="OfficeSeal" type="cn.com.atblue.oa.bean.OfficeSeal"/>
    <typeAlias alias="OfficeSmsPerson" type="cn.com.atblue.oa.bean.OfficeSmsPerson"/>

    <select id="getPagedSealList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <include refid="basic.pageStart"/>
        <![CDATA[
            select t.*,c.user_name,c.real_name,o.orgna_name from OFFICE_SEAL t,c_user c,c_orgnization o
            where t.user_id = c.user_id and c.orgna_id = o.orgna_id
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="realName">
                <![CDATA[c.real_name like '%'||#realName#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="userName">
                <![CDATA[c.user_name like '%'||#userName#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="orgnaId">
                <![CDATA[o.orgna_id=#orgnaId#]]>
            </isNotEmpty>
        </dynamic>
        order by o.orgna_name,c.real_name
        <include refid="basic.pageEnd"/>
    </select>
    <select id="getPagedSealCount" parameterClass="java.util.HashMap" resultClass="int">
        <![CDATA[
            select count(*) cn from OFFICE_SEAL t,c_user c,c_orgnization o
            where t.user_id = c.user_id and c.orgna_id = o.orgna_id
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="realName">
                <![CDATA[c.real_name like '%'||#realName#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="userName">
                <![CDATA[c.user_name like '%'||#userName#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="orgnaId">
                <![CDATA[o.orgna_id=#orgnaId#]]>
            </isNotEmpty>
        </dynamic>
    </select>
    <select id="getPagedQpdList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <include refid="basic.pageStart"/>
        <![CDATA[
            select * from OFFICE_QPD_FORM t
        ]]>
        <dynamic prepend=" where ">
            <isNotEmpty prepend=" and " property="formName">
                <![CDATA[t.FORM_NAME like '%'||#formName#||'%']]>
            </isNotEmpty>
        </dynamic>
        order by t.lrsj desc
        <include refid="basic.pageEnd"/>
    </select>
    <select id="getPagedQpdCount" parameterClass="java.util.HashMap" resultClass="int">
        <![CDATA[
           select count(*) from OFFICE_QPD_FORM t
        ]]>
        <dynamic prepend=" where ">
            <isNotEmpty prepend=" and " property="formName">
                <![CDATA[t.FORM_NAME like '%'||#formName#||'%']]>
            </isNotEmpty>
        </dynamic>
    </select>
    <select id="getPagedMailList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <include refid="basic.pageStart"/>
        <![CDATA[
            select t.*,
                   c.real_name,
                   (case
                     when t.mail_status = '1' then
                      '已保存'
                     when t.mail_status = '2' then
                      '已发送'
                   end) status,
                   func_getMailJsrByMailId(t.mail_id,'0') sbr,
                   func_getMailJsrByMailId(t.mail_id,'r') cgr,
                   (select count(s.user_id)
                      from office_mail_sjr s
                     where s.mail_id = t.mail_id and s.sffs = '0') sbs,
                   (select count(s.user_id)
                      from office_mail_sjr s
                     where s.mail_id = t.mail_id
                       and s.sffs = '1') cgs
              from OFFICE_MAIL t, c_user c
             where t.send_person = c.user_id
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="mailZt">
                <![CDATA[t.MAIL_ZT like '%'||#mailZt#||'%']]>
            </isNotEmpty>
        </dynamic>
        order by t.send_time desc
        <include refid="basic.pageEnd"/>
    </select>
    <select id="getPagedMailCount" parameterClass="java.util.HashMap" resultClass="int">
        <![CDATA[
            select count(*) cn
           from OFFICE_MAIL t,c_user c
          where t.send_person = c.user_id
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="mailZt">
                <![CDATA[t.MAIL_ZT like '%'||#mailZt#||'%']]>
            </isNotEmpty>
        </dynamic>
    </select>
    <select id="getPagedSmsList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <include refid="basic.pageStart"/>
            <![CDATA[
select t.*, u.real_name, o.orgna_name,
(select count(*) from office_sms_person p where p.tzid=t.tzid and p.sfqs = '0') wqs,
(select count(*) from office_sms_person p where p.tzid=t.tzid and p.sfqs = '1') yqs,
func_getSmsPersonsByTzId(t.tzid,'1') yqsry,
func_getSmsPersonsByTzId(t.tzid,'0') wqsry
  from OFFICE_SMS_NOTICE t, c_user u, c_orgnization o
 where t.fsr = u.user_id
   and t.fsbm = o.orgna_id
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="dxnr">
                <![CDATA[t.DXNR like '%'||#dxnr#||'%']]>
            </isNotEmpty>
        </dynamic>
        order by t.CJSJ desc
        <include refid="basic.pageEnd"/>
    </select>
    <select id="getPagedSmsCount" parameterClass="java.util.HashMap" resultClass="int">
        <![CDATA[
           select count(*) cn from OFFICE_SMS_NOTICE t,c_user u,c_orgnization o
        where t.fsr = u.user_id and t.fsbm = o.orgna_id
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="dxnr">
                <![CDATA[t.DXNR like '%'||#dxnr#||'%']]>
            </isNotEmpty>
        </dynamic>
    </select>
    <select id="getAllUserList" resultClass="java.util.HashMap">
        <![CDATA[
            select * from C_USER t order by t.real_name
        ]]>
    </select>
    <select id="getSealByUserId" parameterClass="String" resultClass="OfficeSeal">
        <![CDATA[
            select seal_id as sealId,user_id as userId,seal_pwd as sealPwd,create_person as createPerson,create_time as createTime,create_ip as createIp,seal as seal
            from office_seal where user_id=#value# and rownum = 1
        ]]>
    </select>

    <select id="getPagedHysqList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <include refid="basic.pageStart"/>
        <![CDATA[
            select t.*,o.orgna_name from OFFICE_HYSQ t,c_orgnization o
            where t.sqbm = o.orgna_id
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="hymc">
                <![CDATA[t.HYMC like '%'||#hymc#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="orgnaId">
                <![CDATA[t.SQBM=#orgnaId#]]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
        <include refid="basic.pageEnd"/>
    </select>
    <select id="getPagedHysqCount" parameterClass="java.util.HashMap" resultClass="int">
        <![CDATA[
            select count(*) cn  from OFFICE_HYSQ t,c_orgnization o
            where t.sqbm = o.orgna_id
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="hymc">
                <![CDATA[t.HYMC like '%'||#hymc#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="orgnaId">
                <![CDATA[t.SQBM=#orgnaId#]]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
    </select>

    <delete id="deleteCjhyryBySqid" parameterClass="String">
        <![CDATA[
            delete from OFFICE_CJHYRY t where t.sqid = #value#
        ]]>
    </delete>

    <select id="getCjhyryBySqid" parameterClass="String" resultClass="java.util.HashMap">
        <![CDATA[
            select t.* from OFFICE_CJHYRY t where t.sqid =  #value#
        ]]>
    </select>

    <select id="getMailSjrByMailId" parameterClass="String" resultClass="java.util.HashMap">
        <![CDATA[
            select * from OFFICE_MAIL_SJR t where t.mail_id =  #value#
        ]]>
    </select>
    <select id="getPersonsByTzid" parameterClass="String" resultClass="java.util.HashMap">
        <![CDATA[
            select * from OFFICE_SMS_PERSON t where t.tzid= #value#
        ]]>
    </select>

    <select id="getFlowList" parameterClass="String" resultClass="java.util.HashMap">
        <![CDATA[
            select sa.activity_name sactivity_name,
         t.pending_person,
         ea.activity_name,
         t.real_person,
         c1.real_name,
         c2.real_name real_name2
    from W_CONNECT  t,
         w_instance s,
         w_instance e,
         w_activity sa,
         w_activity ea,
         c_user c1,
         c_user c2
   where t.start_instance = s.instance_id
     and t.end_instance = e.instance_id
     and s.activity_id = sa.activity_id
     and e.activity_id = ea.activity_id
     and t.pending_person = c1.user_id(+)
     and t.real_person = c2.user_id(+)
     and t.process_id = #value#
   order by t.create_time
        ]]>
    </select>

    <select id="getWaitPagedHysqList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <include refid="basic.pageStart"/>
        <![CDATA[
        select t.*, o.orgna_name
  from OFFICE_HYSQ t, w_connect c, w_process p, c_orgnization o
 where t.connect_id = c.connect_id
   and t.process_id = p.process_id
   and t.sqbm = o.orgna_id
   and p.process_status = '1'
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="userId">
                <![CDATA[c.pending_person like '%'||#userId#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="hymc">
                <![CDATA[t.HYMC like '%'||#hymc#||'%']]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
        <include refid="basic.pageEnd"/>
    </select>
    <select id="getWaitPagedHysqCount" parameterClass="java.util.HashMap" resultClass="int">
        <![CDATA[
        select count(*)
  from OFFICE_HYSQ t, w_connect c, w_process p, c_orgnization o
 where t.connect_id = c.connect_id
   and t.process_id = p.process_id
   and t.sqbm = o.orgna_id
   and p.process_status = '1'
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="userId">
                <![CDATA[c.pending_person like '%'||#userId#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="hymc">
                <![CDATA[t.HYMC like '%'||#hymc#||'%']]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
    </select>

    <select id="getAlreadyPagedHysqList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <include refid="basic.pageStart"/>
        <![CDATA[
      select t.*
        from OFFICE_HYSQ t,
             (select c.process_id, count(*) cn
                from w_connect c
               where c.real_person like  '%'||#userId#||'%'
               group by c.process_id) d
       where t.process_id = d.process_id
         and d.cn > 0
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="hymc">
                <![CDATA[t.HYMC like '%'||#hymc#||'%']]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
        <include refid="basic.pageEnd"/>
    </select>
    <select id="getAlreadyPagedHysqCount" parameterClass="java.util.HashMap" resultClass="int">
        <![CDATA[
      select count(*)
        from OFFICE_HYSQ t,
             (select c.process_id, count(*) cn
                from w_connect c
               where c.real_person like  '%'||#userId#||'%'
               group by c.process_id) d
       where t.process_id = d.process_id
         and d.cn > 0
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="hymc">
                <![CDATA[t.HYMC like '%'||#hymc#||'%']]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
    </select>

    <select id="getPagedYysqList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <include refid="basic.pageStart"/>
        <![CDATA[
            select t.*,o.orgna_name from OFFICE_YYSQ t,c_orgnization o
            where t.yybm = o.orgna_id
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="yymc">
                <![CDATA[t.YYMC like '%'||#yymc#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="orgnaId">
                <![CDATA[t.YYBM=#orgnaId#]]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
        <include refid="basic.pageEnd"/>
    </select>
    <select id="getPagedYysqCount" parameterClass="java.util.HashMap" resultClass="int">
        <![CDATA[
            select count(*) cn  from OFFICE_YYSQ t,c_orgnization o
            where t.yybm = o.orgna_id
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="yymc">
                <![CDATA[t.YYMC like '%'||#yymc#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="orgnaId">
                <![CDATA[t.YYBM=#orgnaId#]]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
    </select>
    <select id="getPagedDjfyjsList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <include refid="basic.pageStart"/>
        <![CDATA[
            select * from JYGL_DJFYJS t where 1=1
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="sqr">
                <![CDATA[t.sqr=#sqr#]]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
        <include refid="basic.pageEnd"/>
    </select>
    <select id="getPagedDjfyjsCount" parameterClass="java.util.HashMap" resultClass="int">
        <![CDATA[
            select count(*) cn  from JYGL_DJFYJS t where 1=1
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="sqr">
                <![CDATA[t.sqr=#sqr#]]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
    </select>
    <select id="getWaitPagedYysqList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <include refid="basic.pageStart"/>
        <![CDATA[
        select t.*, o.orgna_name
  from OFFICE_YYSQ t, w_connect c, w_process p, c_orgnization o
 where t.connect_id = c.connect_id
   and t.process_id = p.process_id
   and t.YYBM = o.orgna_id
   and p.process_status = '1'
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="userId">
                <![CDATA[c.pending_person like '%'||#userId#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="yymc">
                <![CDATA[t.YYMC like '%'||#yymc#||'%']]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
        <include refid="basic.pageEnd"/>
    </select>
    <select id="getWaitPagedYysqCount" parameterClass="java.util.HashMap" resultClass="int">
        <![CDATA[
        select count(*)
  from OFFICE_YYSQ t, w_connect c, w_process p, c_orgnization o
 where t.connect_id = c.connect_id
   and t.process_id = p.process_id
   and t.YYBM = o.orgna_id
   and p.process_status = '1'
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="userId">
                <![CDATA[c.pending_person like '%'||#userId#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="yymc">
                <![CDATA[t.YYMC like '%'||#yymc#||'%']]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
    </select>
    <select id="getAlreadyPagedYysqList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <include refid="basic.pageStart"/>
        <![CDATA[
      select t.*
        from OFFICE_YYSQ t,
             (select c.process_id, count(*) cn
                from w_connect c
               where c.real_person like  '%'||#userId#||'%'
               group by c.process_id) d
       where t.process_id = d.process_id
         and d.cn > 0
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="yymc">
                <![CDATA[t.YYMC like '%'||#yymc#||'%']]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
        <include refid="basic.pageEnd"/>
    </select>
    <select id="getAlreadyPagedYysqCount" parameterClass="java.util.HashMap" resultClass="int">
        <![CDATA[
      select count(*)
        from OFFICE_YYSQ t,
             (select c.process_id, count(*) cn
                from w_connect c
               where c.real_person like  '%'||#userId#||'%'
               group by c.process_id) d
       where t.process_id = d.process_id
         and d.cn > 0
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="yymc">
                <![CDATA[t.YYMC like '%'||#yymc#||'%']]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
    </select>
    <select id="getAllQpdFormItemsByFormId" parameterClass="String" resultClass="java.util.HashMap">
        <![CDATA[
        select * from OFFICE_QPD_FORMITEM t where t.form_id = #value# order by px
        ]]>
    </select>
    <select id="getAllQpdFormItemsByFormId2" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
    <![CDATA[
    select t.*, a.spyj
  from OFFICE_QPD_FORMITEM t,
       (select p.form_item_id, p.spyj
          from OFFICE_QPDYJ p
         where p.processid = #processId#)a
 where t.form_item_id = a.form_item_id(+)
   and t.form_id = #formId#
 order by t.px
        ]]>
    </select>
    <delete id="deleteAllQpdFormItemsByFormId" parameterClass="String">
        <![CDATA[
        delete  from OFFICE_QPD_FORMITEM t where t.form_id = #value#
        ]]>
    </delete>
    <delete id="deleteAllMailJsrByMailId" parameterClass="String">
        <![CDATA[
        delete from OFFICE_MAIL_SJR t where t.mail_id =  #value#
        ]]>
    </delete>
    <delete id="deleteAllQpdYjsByProcessId" parameterClass="String">
        <![CDATA[
        delete from OFFICE_QPDYJ t where t.processid  = #value#
        ]]>
    </delete>
    <delete id="deleteSmsPersonsById" parameterClass="int">
        <![CDATA[
        delete from OFFICE_SMS_PERSON t where t.tzid = #value#
        ]]>
    </delete>
    <delete id="delOfficeDocumentsCheck" parameterClass="java.util.HashMap">
        <![CDATA[
        delete from OFFICE_DOCUMENTS_CHECK t where t.documentid=#documentid#
        and t.checkman = #checkman#
        ]]>
    </delete>
    <delete id="delOfficeCirculationCheck" parameterClass="java.util.HashMap">
        <![CDATA[
       delete from OFFICE_CIRCULATION_CHECK t where t.cyid=#pkid#
        and t.checkman = #checkman#
        ]]>
    </delete>
    <update id="updateOfficeCirculationCheck" parameterClass="java.util.HashMap">
        <![CDATA[
       update OFFICE_CIRCULATION_CHECK t
       set t.checkflag = '1', t.checktime = sysdate
     where t.cyid = #pkid#
       and t.checkman = #checkman#
        ]]>
    </update>
    <delete id="deleteAllSms">
        <![CDATA[
        delete from OFFICE_SMS t
        ]]>
    </delete>
    <select id="getFormItemIdByConnectId" parameterClass="java.util.HashMap" resultClass="String">
        <![CDATA[
          select t.form_item_id from OFFICE_QPD_FORMITEM t,w_connect c,w_instance i,w_activity a
        where c.connect_id = #connectId# and form_id=#formId#  and c.end_instance = i.instance_id and i.activity_id = a.activity_id
        and a.activity_name = t.form_item_name and rownum = 1
        ]]>
    </select>
    <select id="getFormItemIdByConnectId2" parameterClass="java.util.HashMap" resultClass="String">
        <![CDATA[
        select * from (select t.form_item_id from OFFICE_QPD_FORMITEM t
        where t.form_id=#formId# order by t.px)where rownum = 1
        ]]>
    </select>
    <select id="getSignDataByProcessId" parameterClass="String" resultClass="String">
        <![CDATA[
        select t.signdata from OFFICE_QPD t where t.processid = #value#
        ]]>
    </select>
    <select id="getMailSjrsByMailId" parameterClass="String" resultClass="java.util.HashMap">
        <![CDATA[
        select t.sffs,c.user_id,c.email from OFFICE_MAIL_SJR t,c_user c
        where t.user_id = c.user_id and t.mail_id =  #value#
        ]]>
    </select>
    <select id="getSmsPersonsByTzId" parameterClass="String" resultClass="java.util.HashMap">
        <![CDATA[
          select c.user_id, c.mobile, c.real_name,t.SFQS
            from Office_Sms_Person t, c_user c
           where t.user_id = c.user_id
             and t.tzid = #value#
           order by c.real_name
        ]]>
    </select>
    <update id="updateMailJsrSfjs" parameterClass="java.util.HashMap">
        <![CDATA[
       update OFFICE_MAIL_SJR t set t.sffs = '1' where t.mail_id = #mailId# and t.user_id = #userId#
        ]]>
    </update>
    <update id="updateSmsPersonSffs" parameterClass="String">
        <![CDATA[
       update OFFICE_SMS_PERSON t set t.sffs = '0' where t.sq_id = #value#   and t.tzid = #value#
        ]]>
    </update>
    <update id="updateSmsPersons" parameterClass="java.util.HashMap">
        <![CDATA[
        update OFFICE_SMS_PERSON t set t.sfqs = '1',t.read_time=sysdate
        where t.tzid =#tzId# and t.user_id = #userId#
        ]]>
    </update>

    <update id="updateSmsPerson" parameterClass="java.util.HashMap">
        <![CDATA[
        update OFFICE_SMS_PERSON t set t.sfqs = '1',t.read_time=sysdate
        where t.tzid =#tzId# and t.phone = #phone#
        ]]>
    </update>

    <select id="getSmsSequence" resultClass="int">
        <![CDATA[
       select seq_sms.nextval from dual
        ]]>
    </select>

    <select id="getSmsPersonsList" resultClass="OfficeSmsPerson">
        <![CDATA[
       select
        pk_id as pkId,tzid as tzid,user_id as userId,user_name as userName,phone as phone,create_time as createTime,read_time as readTime,sfqs as sfqs,sffs as sffs,tzlb as tzlb,sq_id as sqId,dxnr as dxnr
        from OFFICE_SMS_PERSON t where t.sffs = '0'
        ]]>
    </select>

    <select id="getLatestAnnounce" resultClass="java.util.HashMap" parameterClass="int">
    <![CDATA[
        select * from (select t.* from OFFICE_NOTICE t where t.ispublic = '0'
        and t.enddate >= sysdate order by t.rlsdate desc) where rownum <= #value#
        ]]>
</select>

    <select id="getLatestNotice" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
    <![CDATA[
                select * from (select *
          from office_notice
         where noticeid in
               (select office_notice.noticeid
                  from office_notice, office_notice_check
                 where office_notice.noticeid = office_notice_check.noticeid
                   and office_notice_check.checkman = #userid#
                   and trunc(office_notice.enddate) >= trunc(sysdate)
                   and office_notice_check.checkflag = '0')
         order by office_notice.startime)
         where rownum <= #cn#
        ]]>
</select>

    <select id="getOfficeDocumentsCheckList" resultClass="java.util.HashMap" parameterClass="String">
    <![CDATA[
        select t.checkman,c.real_name,t.checkflag from OFFICE_DOCUMENTS_CHECK t,c_user c
    where t.documentid=#value# and t.checkman = c.user_id
    order by c.real_name
        ]]>
</select>
    <select id="getOfficeCirculationCheckList" resultClass="java.util.HashMap" parameterClass="String">
    <![CDATA[
       select t.checkman,c.real_name,t.checkflag from OFFICE_CIRCULATION_CHECK t,c_user c
    where t.cyid = #value# and t.checkman = c.user_id
    order by c.real_name
        ]]>
</select>

    <select id="getWaitPagedOfficeCirculationList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <include refid="basic.pageStart"/>
        <![CDATA[
    select t.*
  from Office_Circulation t, w_connect c, w_process p
 where t.connect_id = c.connect_id
   and t.process_id = p.process_id
   and p.process_status = '1'
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="userId">
                <![CDATA[c.pending_person like '%'||#userId#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="wjmc">
                <![CDATA[t.WJMC like '%'||#wjmc#||'%']]>
            </isNotEmpty>
        </dynamic>
        order by t.LRSJ desc
        <include refid="basic.pageEnd"/>
    </select>
    <select id="getWaitPagedOfficeCirculationCount" parameterClass="java.util.HashMap" resultClass="int">
        <![CDATA[
         select count(*) cn
  from Office_Circulation t, w_connect c, w_process p
 where t.connect_id = c.connect_id
   and t.process_id = p.process_id
   and p.process_status = '1'
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="userId">
                <![CDATA[c.pending_person like '%'||#userId#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="wjmc">
                <![CDATA[t.WJMC like '%'||#wjmc#||'%']]>
            </isNotEmpty>
        </dynamic>
    </select>
    <select id="getAlreadyPagedOfficeCirculationList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <include refid="basic.pageStart"/>
        <![CDATA[
      select t.*
        from Office_Circulation t,
             (select c.process_id, count(*) cn
                from w_connect c
               where c.real_person like  '%'||#userId#||'%'
               group by c.process_id) d
       where t.process_id = d.process_id
         and d.cn > 0
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="wjmc">
                <![CDATA[t.WJMC like '%'||#wjmc#||'%']]>
            </isNotEmpty>
        </dynamic>
        order by t.LRSJ desc
        <include refid="basic.pageEnd"/>
    </select>
    <select id="getAlreadyPagedOfficeCirculationCount" parameterClass="java.util.HashMap" resultClass="int">
        <![CDATA[
      select count(*)
        from Office_Circulation t,
             (select c.process_id, count(*) cn
                from w_connect c
               where c.real_person like  '%'||#userId#||'%'
               group by c.process_id) d
       where t.process_id = d.process_id
         and d.cn > 0
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="wjmc">
                <![CDATA[t.WJMC like '%'||#wjmc#||'%']]>
            </isNotEmpty>
        </dynamic>
    </select>
    <select id="isAllCirculationCheck" parameterClass="String" resultClass="int">
        <![CDATA[
     select count(*) cn   from (
select count(*) totalcn,
sum(case when t.checkflag = '1' then 1 else 0 end) checked
from OFFICE_CIRCULATION_CHECK t  where t.cyid = #value#
group by t.cyid) c where c.totalcn = checked
        ]]>
    </select>
</sqlMap>