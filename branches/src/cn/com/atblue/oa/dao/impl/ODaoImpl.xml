<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >

<sqlMap namespace="oa.dao">
    <typeAlias alias="OfficeSeal" type="cn.com.atblue.oa.bean.OfficeSeal"/>

    <select id="getPagedSealList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <include refid="basic.pageStart"/>
        <![CDATA[
            select t.*,c.user_name,c.real_name,o.orgna_name from OFFICE_SEAL t,c_user c,c_orgnization o
            where t.user_id = c.user_id and c.orgna_id = o.orgna_id
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="realName">
                <![CDATA[c.real_name like '%'||#realName#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="userName">
                <![CDATA[c.user_name like '%'||#userName#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="orgnaId">
                <![CDATA[o.orgna_id=#orgnaId#]]>
            </isNotEmpty>
        </dynamic>
        order by o.orgna_name,c.real_name
        <include refid="basic.pageEnd"/>
    </select>
    <select id="getPagedSealCount" parameterClass="java.util.HashMap" resultClass="int">
        <![CDATA[
            select count(*) cn from OFFICE_SEAL t,c_user c,c_orgnization o
            where t.user_id = c.user_id and c.orgna_id = o.orgna_id
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="realName">
                <![CDATA[c.real_name like '%'||#realName#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="userName">
                <![CDATA[c.user_name like '%'||#userName#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="orgnaId">
                <![CDATA[o.orgna_id=#orgnaId#]]>
            </isNotEmpty>
        </dynamic>
    </select>
    <select id="getAllUserList" resultClass="java.util.HashMap">
        <![CDATA[
            select * from C_USER t order by t.real_name
        ]]>
    </select>
    <select id="getSealByUserId" parameterClass="String" resultClass="OfficeSeal">
        <![CDATA[
            select seal_id as sealId,user_id as userId,seal_pwd as sealPwd,create_person as createPerson,create_time as createTime,create_ip as createIp,seal as seal
            from office_seal where user_id=#value# and rownum = 1
        ]]>
    </select>

    <select id="getPagedHysqList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <include refid="basic.pageStart"/>
        <![CDATA[
            select t.*,o.orgna_name from OFFICE_HYSQ t,c_orgnization o
            where t.sqbm = o.orgna_id
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="hymc">
                <![CDATA[t.HYMC like '%'||#hymc#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="orgnaId">
                <![CDATA[t.SQBM=#orgnaId#]]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
        <include refid="basic.pageEnd"/>
    </select>
    <select id="getPagedHysqCount" parameterClass="java.util.HashMap" resultClass="int">
        <![CDATA[
            select count(*) cn  from OFFICE_HYSQ t,c_orgnization o
            where t.sqbm = o.orgna_id
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="hymc">
                <![CDATA[t.HYMC like '%'||#hymc#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="orgnaId">
                <![CDATA[t.SQBM=#orgnaId#]]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
    </select>

    <delete id="deleteCjhyryBySqid" parameterClass="String">
        <![CDATA[
            delete from OFFICE_CJHYRY t where t.sqid = #value#
        ]]>
    </delete>

    <select id="getCjhyryBySqid" parameterClass="String" resultClass="java.util.HashMap">
        <![CDATA[
            select t.* from OFFICE_CJHYRY t where t.sqid =  #value#
        ]]>
    </select>

    <select id="getFlowList" parameterClass="String" resultClass="java.util.HashMap">
        <![CDATA[
            select sa.activity_name sactivity_name,
         t.pending_person,
         ea.activity_name,
         t.real_person,
         c1.real_name,
         c2.real_name real_name2
    from W_CONNECT  t,
         w_instance s,
         w_instance e,
         w_activity sa,
         w_activity ea,
         c_user c1,
         c_user c2
   where t.start_instance = s.instance_id
     and t.end_instance = e.instance_id
     and s.activity_id = sa.activity_id
     and e.activity_id = ea.activity_id
     and t.pending_person = c1.user_id(+)
     and t.real_person = c2.user_id(+)
     and t.process_id = #value#
   order by t.create_time
        ]]>
    </select>

    <select id="getWaitPagedHysqList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <include refid="basic.pageStart"/>
        <![CDATA[
        select t.*, o.orgna_name
  from OFFICE_HYSQ t, w_connect c, w_process p, c_orgnization o
 where t.connect_id = c.connect_id
   and t.process_id = p.process_id
   and t.sqbm = o.orgna_id
   and p.process_status = '1'
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="userId">
                <![CDATA[c.pending_person like '%'||#userId#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="hymc">
                <![CDATA[t.HYMC like '%'||#hymc#||'%']]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
        <include refid="basic.pageEnd"/>
    </select>
    <select id="getWaitPagedHysqCount" parameterClass="java.util.HashMap" resultClass="int">
        <![CDATA[
        select count(*)
  from OFFICE_HYSQ t, w_connect c, w_process p, c_orgnization o
 where t.connect_id = c.connect_id
   and t.process_id = p.process_id
   and t.sqbm = o.orgna_id
   and p.process_status = '1'
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="userId">
                <![CDATA[c.pending_person like '%'||#userId#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="hymc">
                <![CDATA[t.HYMC like '%'||#hymc#||'%']]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
    </select>

    <select id="getAlreadyPagedHysqList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <include refid="basic.pageStart"/>
        <![CDATA[
      select t.*
        from OFFICE_HYSQ t,
             (select c.process_id, count(*) cn
                from w_connect c
               where c.real_person like  '%'||#userId#||'%'
               group by c.process_id) d
       where t.process_id = d.process_id
         and d.cn > 0
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="hymc">
                <![CDATA[t.HYMC like '%'||#hymc#||'%']]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
        <include refid="basic.pageEnd"/>
    </select>
    <select id="getAlreadyPagedHysqCount" parameterClass="java.util.HashMap" resultClass="int">
        <![CDATA[
      select count(*)
        from OFFICE_HYSQ t,
             (select c.process_id, count(*) cn
                from w_connect c
               where c.real_person like  '%'||#userId#||'%'
               group by c.process_id) d
       where t.process_id = d.process_id
         and d.cn > 0
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="hymc">
                <![CDATA[t.HYMC like '%'||#hymc#||'%']]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
    </select>

    <select id="getPagedYysqList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <include refid="basic.pageStart"/>
        <![CDATA[
            select t.*,o.orgna_name from OFFICE_YYSQ t,c_orgnization o
            where t.yybm = o.orgna_id
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="yymc">
                <![CDATA[t.YYMC like '%'||#yymc#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="orgnaId">
                <![CDATA[t.YYBM=#orgnaId#]]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
        <include refid="basic.pageEnd"/>
    </select>
    <select id="getPagedYysqCount" parameterClass="java.util.HashMap" resultClass="int">
        <![CDATA[
            select count(*) cn  from OFFICE_YYSQ t,c_orgnization o
            where t.yybm = o.orgna_id
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="yymc">
                <![CDATA[t.YYMC like '%'||#yymc#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="orgnaId">
                <![CDATA[t.YYBM=#orgnaId#]]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
    </select>
    <select id="getWaitPagedYysqList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <include refid="basic.pageStart"/>
        <![CDATA[
        select t.*, o.orgna_name
  from OFFICE_YYSQ t, w_connect c, w_process p, c_orgnization o
 where t.connect_id = c.connect_id
   and t.process_id = p.process_id
   and t.YYBM = o.orgna_id
   and p.process_status = '1'
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="userId">
                <![CDATA[c.pending_person like '%'||#userId#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="yymc">
                <![CDATA[t.YYMC like '%'||#yymc#||'%']]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
        <include refid="basic.pageEnd"/>
    </select>
    <select id="getWaitPagedYysqCount" parameterClass="java.util.HashMap" resultClass="int">
        <![CDATA[
        select count(*)
  from OFFICE_YYSQ t, w_connect c, w_process p, c_orgnization o
 where t.connect_id = c.connect_id
   and t.process_id = p.process_id
   and t.YYBM = o.orgna_id
   and p.process_status = '1'
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="userId">
                <![CDATA[c.pending_person like '%'||#userId#||'%']]>
            </isNotEmpty>
            <isNotEmpty prepend=" and " property="yymc">
                <![CDATA[t.YYMC like '%'||#yymc#||'%']]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
    </select>
    <select id="getAlreadyPagedYysqList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <include refid="basic.pageStart"/>
        <![CDATA[
      select t.*
        from OFFICE_YYSQ t,
             (select c.process_id, count(*) cn
                from w_connect c
               where c.real_person like  '%'||#userId#||'%'
               group by c.process_id) d
       where t.process_id = d.process_id
         and d.cn > 0
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="yymc">
                <![CDATA[t.YYMC like '%'||#yymc#||'%']]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
        <include refid="basic.pageEnd"/>
    </select>
    <select id="getAlreadyPagedYysqCount" parameterClass="java.util.HashMap" resultClass="int">
        <![CDATA[
      select count(*)
        from OFFICE_YYSQ t,
             (select c.process_id, count(*) cn
                from w_connect c
               where c.real_person like  '%'||#userId#||'%'
               group by c.process_id) d
       where t.process_id = d.process_id
         and d.cn > 0
        ]]>
        <dynamic prepend=" and ">
            <isNotEmpty prepend=" and " property="yymc">
                <![CDATA[t.YYMC like '%'||#yymc#||'%']]>
            </isNotEmpty>
        </dynamic>
        order by t.sqsj desc
    </select>
</sqlMap>